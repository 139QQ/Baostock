# Baostock åŸºé‡‘æ•°æ®åº”ç”¨ - ç¼“å­˜æ¶æ„è¯´æ˜æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯
- **æ–‡æ¡£ç‰ˆæœ¬:** v1.0
- **åˆ›å»ºæ—¥æœŸ:** 2025-10-27
- **æœ€åæ›´æ–°:** 2025-10-27
- **æ–‡æ¡£çŠ¶æ€:** æœ€æ–°

---

## 1. ç¼“å­˜æ¶æ„æ¦‚è¿°

### 1.1 ç¼“å­˜ç³»ç»Ÿè®¾è®¡åŸåˆ™

Baostock åŸºé‡‘æ•°æ®åº”ç”¨é‡‡ç”¨ä¸‰å±‚ç¼“å­˜æ¶æ„è®¾è®¡ï¼Œæ—¨åœ¨æä¾›é«˜æ•ˆã€ç¨³å®šã€å¯æ‰©å±•çš„æ•°æ®ç¼“å­˜è§£å†³æ–¹æ¡ˆï¼š

**æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼š**
- **åˆ†å±‚ç¼“å­˜:** L1(å†…å­˜) + L2(ç£ç›˜) + L3(ç½‘ç»œ) ä¸‰å±‚æ¶æ„
- **ç»Ÿä¸€ç®¡ç†:** æ‰€æœ‰ç¼“å­˜æ“ä½œé€šè¿‡ç»Ÿä¸€æ¥å£è¿›è¡Œ
- **æ€§èƒ½ä¼˜å…ˆ:** æœ€å¤§åŒ–ç¼“å­˜å‘½ä¸­ç‡ï¼Œæœ€å°åŒ–ç½‘ç»œè¯·æ±‚
- **å®¹é”™æœºåˆ¶:** å¤šå±‚æ¬¡é™çº§ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§
- **å¯ç»´æŠ¤æ€§:** æ¸…æ™°çš„æ¥å£è®¾è®¡å’Œå®Œæ•´çš„ç›‘æ§ä½“ç³»

### 1.2 ç¼“å­˜æ¶æ„å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨å±‚ (Application Layer)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ç»Ÿä¸€ç¼“å­˜æ¥å£å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           UnifiedHiveCacheManager                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ L1å†…å­˜ç¼“å­˜  â”‚  â”‚ L2ç£ç›˜ç¼“å­˜  â”‚  â”‚ L3ç½‘ç»œç¼“å­˜  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ (LRU+ä¼˜å…ˆçº§)â”‚  â”‚ (Hive DB)   â”‚  â”‚ (Dio HTTP) â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        å­˜å‚¨å±‚ (Storage Layer)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  å†…å­˜å­˜å‚¨    â”‚  â”‚  ç£ç›˜å­˜å‚¨    â”‚  â”‚  ç½‘ç»œå­˜å‚¨    â”‚         â”‚
â”‚  â”‚  (RAM)      â”‚  â”‚  (Hive)     â”‚  â”‚  (API)      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. é¡¹ç›®ä¸­ä½¿ç”¨çš„ç¼“å­˜ç±»å‹è¯¦ç»†åˆ†æ

### 2.1 Hive ç¼“å­˜ç³»ç»Ÿ (ä¸»è¦ç¼“å­˜)

**æ–‡ä»¶ä½ç½®:** `lib/src/core/cache/unified_hive_cache_manager.dart`

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… **L1 å†…å­˜ç¼“å­˜:** é«˜é€Ÿè®¿é—®ï¼ŒåŸºäºLRU+ä¼˜å…ˆçº§ç®—æ³•
- âœ… **L2 ç£ç›˜ç¼“å­˜:** æŒä¹…åŒ–å­˜å‚¨ï¼ŒåŸºäºHiveæ•°æ®åº“
- âœ… **æ™ºèƒ½æœç´¢:** å†…ç½®æœç´¢ç´¢å¼•å’Œå‰ç¼€åŒ¹é…
- âœ… **æ€§èƒ½ç›‘æ§:** å®Œæ•´çš„å‘½ä¸­ç‡å’Œæ€§èƒ½ç»Ÿè®¡
- âœ… **å®¹é”™æœºåˆ¶:** å¤šç§åˆå§‹åŒ–ç­–ç•¥å’Œé™çº§æ–¹æ¡ˆ

**åº”ç”¨åœºæ™¯:** åŸºé‡‘æ•°æ®ã€æœç´¢ç»“æœã€ç”¨æˆ·è®¾ç½®ç­‰æ ¸å¿ƒæ•°æ®ç¼“å­˜

### 2.2 Dio HTTP ç¼“å­˜ (L3 ç½‘ç»œç¼“å­˜)

**å®ç°æ–¹å¼:** `dio_http_cache_lts` æ’ä»¶

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… **HTTP æ ‡å‡†ç¼“å­˜:** æ”¯æŒCache-Controlã€ETagç­‰æ ‡å‡†
- âœ… **è‡ªåŠ¨ç®¡ç†:** é€æ˜çš„ç¼“å­˜ç­–ç•¥ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
- âœ… **ç½‘ç»œä¼˜åŒ–:** å‡å°‘é‡å¤ç½‘ç»œè¯·æ±‚

**åº”ç”¨åœºæ™¯:** API å“åº”æ•°æ®çš„ç½‘ç»œå±‚ç¼“å­˜

### 2.3 SharedPreferences (è½»é‡çº§é…ç½®ç¼“å­˜)

**åº”ç”¨æ¨¡å—:** ç”¨æˆ·åå¥½è®¾ç½®ã€åº”ç”¨é…ç½®

**æ–‡ä»¶ç¤ºä¾‹:** `lib/src/features/fund/presentation/domain/services/fund_user_preferences.dart`

**ç¼“å­˜å†…å®¹:**
- åº”ç”¨ä¸»é¢˜è®¾ç½®
- ç”¨æˆ·ç•Œé¢åå¥½
- åŠŸèƒ½å¼€å…³é…ç½®
- ç®€å•çš„é”®å€¼å¯¹æ•°æ®

### 2.4 Flutter Secure Storage (æ•æ„Ÿæ•°æ®ç¼“å­˜)

**æ–‡ä»¶ä½ç½®:** `lib/src/core/services/secure_storage_service.dart`

**å®‰å…¨ç‰¹æ€§:**
- âœ… **åŠ å¯†å­˜å‚¨:** æ•æ„Ÿæ•°æ®è‡ªåŠ¨åŠ å¯†
- âœ… **å®‰å…¨è®¿é—®:** ç³»ç»Ÿçº§å®‰å…¨ä¿æŠ¤
- âœ… **æ•°æ®éš”ç¦»:** ä¸æ™®é€šç¼“å­˜ç‰©ç†éš”ç¦»

**åº”ç”¨åœºæ™¯:**
- ç”¨æˆ·è®¤è¯ä»¤ç‰Œ
- API å¯†é’¥
- å…¶ä»–æ•æ„Ÿé…ç½®ä¿¡æ¯

### 2.5 çŠ¶æ€ç®¡ç†ç¼“å­˜ (Cubit/State ç¼“å­˜)

**åº”ç”¨åœºæ™¯:**
- åŸºé‡‘å¯¹æ¯”çŠ¶æ€ (`comparison_cache_cubit.dart`)
- æœç´¢è¿‡æ»¤çŠ¶æ€ (`filter_cache_service.dart`)
- æŠ•èµ„ç»„åˆçŠ¶æ€ (`portfolio_profit_cache_service.dart`)

**ç‰¹ç‚¹:** ä¸´æ—¶ç¼“å­˜åº”ç”¨è¿è¡Œæ—¶çŠ¶æ€ï¼Œåº”ç”¨é‡å¯åä¸¢å¤±

---

## 3. å½“å‰å­˜åœ¨çš„ç¼“å­˜é—®é¢˜åŠæ³¨æ„äº‹é¡¹

### 3.1 ğŸ”´ å…³é”®é—®é¢˜ï¼šé‡å¤ç¼“å­˜å®ç°

**é—®é¢˜æè¿°:** é¡¹ç›®ä¸­å­˜åœ¨å¤šä¸ªåŠŸèƒ½é‡å¤çš„ç¼“å­˜ç®¡ç†å™¨

**å…·ä½“å†—ä½™:**
```dart
// ğŸš¨ å·²è¯†åˆ«çš„é‡å¤ç¼“å­˜å®ç°ï¼š
lib/src/core/cache/hive_cache_manager.dart              // åŸºç¡€ç‰ˆæœ¬
lib/src/core/cache/enhanced_hive_cache_manager.dart      // å¢å¼ºç‰ˆæœ¬
lib/src/core/cache/optimized_cache_manager.dart          // ä¼˜åŒ–ç‰ˆæœ¬
lib/src/services/optimized_cache_manager_v3.dart          // æœåŠ¡å±‚ç‰ˆæœ¬
lib/src/services/intelligent_cache_manager.dart           // æ™ºèƒ½ç‰ˆæœ¬
lib/src/services/fund_data_cache_service.dart            // åŸºé‡‘æ•°æ®æœåŠ¡
lib/src/services/smart_preloading_manager.dart           // æ™ºèƒ½é¢„åŠ è½½
```

**å½±å“:**
- ä»£ç ç»´æŠ¤æˆæœ¬é«˜
- å†…å­˜å ç”¨å¢åŠ 
- ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜
- æ€§èƒ½èµ„æºæµªè´¹

### 3.2 ğŸŸ¡ ä¸­ç­‰é—®é¢˜ï¼šç¼“å­˜é”®å‘½åä¸ç»Ÿä¸€

**é—®é¢˜ç¤ºä¾‹:**
```dart
// ä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„å‘½åè§„èŒƒï¼š
"fund_${fundCode}"           // æ¨¡å—A
"funds_${fundCode}"          // æ¨¡å—B
"cache_fund_${fundCode}"     // æ¨¡å—C
"user_fav_${fundCode}"       // æ¨¡å—D
```

**å»ºè®®è§£å†³:** ç»Ÿä¸€ç¼“å­˜é”®å‘½åè§„èŒƒï¼Œä¾‹å¦‚ `module:type:identifier` æ ¼å¼

### 3.3 ğŸŸ¡ ä¸­ç­‰é—®é¢˜ï¼šç¼“å­˜è¿‡æœŸç­–ç•¥ä¸ä¸€è‡´

**ç°çŠ¶åˆ†æ:**
- æœ‰äº›ç¼“å­˜æ°¸ä¸è¿‡æœŸ
- è¿‡æœŸæ—¶é—´ç¡¬ç¼–ç ï¼Œæ— æ³•ç»Ÿä¸€é…ç½®
- ä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„è¿‡æœŸç­–ç•¥
- ç¼ºä¹è‡ªåŠ¨æ¸…ç†æœºåˆ¶

### 3.4 ğŸŸ  æ€§èƒ½é—®é¢˜ï¼šç¼“å­˜ç©¿é€å’Œé›ªå´©é£é™©

**æ½œåœ¨é£é™©:**
- å¤§é‡æ— æ•ˆç¼“å­˜è¯·æ±‚å¯¼è‡´ç¼“å­˜ç©¿é€
- ç¼“å­˜é›†ä½“è¿‡æœŸå¯èƒ½å¯¼è‡´é›ªå´©æ•ˆåº”
- å†…å­˜ç¼“å­˜æº¢å‡ºé£é™©
- ç£ç›˜ç©ºé—´æ— é™å¢é•¿

### 3.5 ğŸ”µ ç›‘æ§é—®é¢˜ï¼šç¼ºä¹ç»Ÿä¸€çš„ç¼“å­˜ç›‘æ§

**ç¼ºå¤±åŠŸèƒ½:**
- å…¨å±€ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
- ç¼“å­˜æ€§èƒ½ç›‘æ§é¢æ¿
- å¼‚å¸¸ç¼“å­˜æ“ä½œå‘Šè­¦
- ç¼“å­˜ä½¿ç”¨æƒ…å†µåˆ†æ

---

## 4. ç»Ÿä¸€ç¼“å­˜æ¶æ„è®¾è®¡

### 4.1 æ ¸å¿ƒæ¶æ„ï¼šUnifiedHiveCacheManager

**æ¶æ„ä¼˜åŠ¿:**
- âœ… **ä¸‰å±‚ç¼“å­˜:** L1+L2+L3 å®Œæ•´æ¶æ„
- âœ… **æ™ºèƒ½è°ƒåº¦:** ä¼˜å…ˆçº§é©±åŠ¨çš„ç¼“å­˜ç­–ç•¥
- âœ… **æ€§èƒ½ä¼˜åŒ–:** æ‰¹é‡æ“ä½œã€å¹¶è¡Œå¤„ç†ã€ç´¢å¼•ä¼˜åŒ–
- âœ… **å®¹é”™æœºåˆ¶:** å¤šç§åˆå§‹åŒ–å’Œé™çº§ç­–ç•¥
- âœ… **ç›‘æ§å®Œå–„:** è¯¦ç»†çš„æ€§èƒ½ç»Ÿè®¡å’Œæ—¥å¿—

### 4.2 ç¼“å­˜ç­–ç•¥é…ç½®

```dart
// ç¼“å­˜ç­–ç•¥æšä¸¾
enum CacheStrategy {
  memoryFirst,    // å†…å­˜ä¼˜å…ˆ - æœ€å¿«è®¿é—®
  diskFirst,      // ç£ç›˜ä¼˜å…ˆ - æŒä¹…åŒ–ä¼˜å…ˆ
  hybrid,         // æ··åˆæ¨¡å¼ - æ¨èç­–ç•¥
}

// ç¼“å­˜ä¼˜å…ˆçº§
enum CachePriority {
  low(1),         // ä½ä¼˜å…ˆçº§ - å¹¿å‘Šã€ä¸´æ—¶æ•°æ®
  normal(2),      // æ™®é€šä¼˜å…ˆçº§ - å¸¸è§„ä¸šåŠ¡æ•°æ®
  high(3),        // é«˜ä¼˜å…ˆçº§ - é‡è¦ä¸šåŠ¡æ•°æ®
  critical(4);    // å…³é”®ä¼˜å…ˆçº§ - ç”¨æˆ·çŠ¶æ€ã€é…ç½®
}
```

### 4.3 æ•°æ®æµè½¬æœºåˆ¶

```
æ•°æ®è¯»å–æµç¨‹:
ç”¨æˆ·è¯·æ±‚ â†’ L1ç¼“å­˜æ£€æŸ¥ â†’ L2ç¼“å­˜æ£€æŸ¥ â†’ L3ç½‘ç»œè¯·æ±‚ â†’ ç¼“å­˜å†™å…¥ â†’ è¿”å›æ•°æ®
    â†“           â†“           â†“           â†“           â†“
   å‘½ä¸­      â†’  æœªå‘½ä¸­   â†’   æœªå‘½ä¸­   â†’   æˆåŠŸ     â†’  åŒæ­¥æ›´æ–°
   ç›´æ¥è¿”å›     æå‡åˆ°L1      å‘èµ·è¯·æ±‚    å†™å…¥æ‰€æœ‰å±‚    æ›´æ–°ç´¢å¼•
```

### 4.4 å…³é”®é…ç½®å‚æ•°

```dart
// ç¼“å­˜é…ç½®å¸¸é‡
static const int _maxMemorySize = 500;                    // L1ç¼“å­˜é¡¹æ•°é™åˆ¶
static const int _maxMemoryBytes = 100 * 1024 * 1024;     // L1å†…å­˜é™åˆ¶: 100MB
static const Duration _cleanupInterval = Duration(minutes: 5);  // æ¸…ç†é—´éš”
static const Duration _defaultExpiration = Duration(hours: 6);  // é»˜è®¤è¿‡æœŸæ—¶é—´
```

---

## 5. ç¼“å­˜æœ€ä½³å®è·µå’Œç»´æŠ¤æŒ‡å—

### 5.1 ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ

#### 5.1.1 ç¼“å­˜é”®å‘½åè§„èŒƒ

```dart
// âœ… æ¨èæ ¼å¼ï¼šmodule:type:identifier
'fund:detail:161725'
'fund:ranking:all'
'user:preferences:theme'
'search:results:tech_funds'

// âŒ é¿å…çš„å‘½åæ–¹å¼
'fund_161725'                    // ç¼ºä¹è¯­ä¹‰
'data_cache_12345'               // é€šç”¨æ€§è¿‡å¼º
'temp_${DateTime.now()}'         // æ— æ³•è¯†åˆ«
```

#### 5.1.2 ç¼“å­˜ä¼˜å…ˆçº§è®¾ç½®æŒ‡å—

```dart
// ğŸŸ¢ Critical (4) - ç«‹å³ç¼“å­˜ï¼Œæ°¸ä¸æ¸…é™¤
await cacheManager.put(
  'user:session:current',
  userData,
  priority: CachePriority.critical,
  expiration: Duration(days: 30),
);

// ğŸŸ¡ High (3) - ä¼˜å…ˆä¿ç•™ï¼Œå¿«é€Ÿè®¿é—®
await cacheManager.put(
  'fund:detail:${fundCode}',
  fundData,
  priority: CachePriority.high,
  expiration: Duration(hours: 6),
);

// ğŸŸ  Normal (2) - æ­£å¸¸ç¼“å­˜ï¼ŒæŒ‰éœ€ç®¡ç†
await cacheManager.put(
  'search:results:${query}',
  searchResults,
  priority: CachePriority.normal,
  expiration: Duration(hours: 2),
);

// âšª Low (1) - ä¸´æ—¶ç¼“å­˜ï¼Œä¼˜å…ˆæ¸…é™¤
await cacheManager.put(
  'recommendation:random',
  recommendations,
  priority: CachePriority.low,
  expiration: Duration(minutes: 30),
);
```

#### 5.1.3 æ‰¹é‡æ“ä½œä¼˜åŒ–

```dart
// âœ… ä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ€§èƒ½
final fundData = <String, FundData>{
  for (final fund in funds)
    'fund:detail:${fund.code}': fund
};
await cacheManager.putAll(fundData, priority: CachePriority.high);

// âŒ é¿å…å¾ªç¯å•ä¸ªæ“ä½œ
for (final fund in funds) {
  await cacheManager.put('fund:detail:${fund.code}', fund); // ä½æ•ˆ
}
```

### 5.2 ç¼“å­˜æ¸…ç†ç­–ç•¥

#### 5.2.1 è‡ªåŠ¨æ¸…ç†æœºåˆ¶

```dart
// å®šæœŸæ¸…ç† (å·²å†…ç½®åœ¨ UnifiedHiveCacheManager)
// - æ¯5åˆ†é’Ÿæ¸…ç†è¿‡æœŸæ•°æ®
// - å†…å­˜æº¢å‡ºæ—¶LRUæ·˜æ±°
// - å¯åŠ¨æ—¶æ¸…ç†æŸåæ•°æ®
```

#### 5.2.2 æ‰‹åŠ¨æ¸…ç†æ“ä½œ

```dart
// æ¸…ç†ç‰¹å®šæ¨¡å—ç¼“å­˜
await cacheManager.removeWhere((key, value) => key.startsWith('fund:'));

// æ¸…ç†è¿‡æœŸæ•°æ®
await cacheManager.cleanupExpired();

// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
await cacheManager.clear();
```

### 5.3 æ€§èƒ½ç›‘æ§å’Œè°ƒè¯•

#### 5.3.1 è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯

```dart
final stats = cacheManager.getStats();
print('ç¼“å­˜ç»Ÿè®¡: ${stats}');
// è¾“å‡ºå†…å®¹ï¼š
// {
//   'initialized': true,
//   'strategy': 'hybrid',
//   'l1CacheSize': 245,
//   'l2CacheSize': 1247,
//   'hitRate': '87.3%',
//   'averageWriteTime': '2.4ms'
// }
```

#### 5.3.2 ç¼“å­˜æ€§èƒ½åˆ†æ

```dart
// ğŸ” å…³é”®æ€§èƒ½æŒ‡æ ‡ç›‘æ§
double hitRate = (memoryHits + diskHits) / totalRequests;     // å‘½ä¸­ç‡
int memoryUsage = _l1Cache.getCurrentMemoryBytes();           // å†…å­˜ä½¿ç”¨
int diskUsage = await _getDiskUsage();                        // ç£ç›˜ä½¿ç”¨
Duration avgResponse = _calculateAverageResponseTime();        // å¹³å‡å“åº”æ—¶é—´

// âš ï¸ æ€§èƒ½å‘Šè­¦é˜ˆå€¼
if (hitRate < 0.7) _logWarning('ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½');
if (memoryUsage > _maxMemoryBytes * 0.8) _logWarning('å†…å­˜ä½¿ç”¨è¿‡é«˜');
```

### 5.4 æ•…éšœæ’é™¤æŒ‡å—

#### 5.4.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

**é—®é¢˜1: ç¼“å­˜åˆå§‹åŒ–å¤±è´¥**
```dart
// âœ… è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥å­˜å‚¨æƒé™å’Œè·¯å¾„
try {
  await cacheManager.initialize();
} catch (e) {
  // è‡ªåŠ¨é™çº§åˆ°å†…å­˜æ¨¡å¼
  await cacheManager.initialize(strategy: CacheStrategy.memoryFirst);
}
```

**é—®é¢˜2: ç¼“å­˜æ•°æ®ä¸ä¸€è‡´**
```dart
// âœ… è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨äº‹åŠ¡æ“ä½œ
await cacheManager.transaction((manager) async {
  await manager.remove('old:data');
  await manager.put('new:data', newData);
});
```

**é—®é¢˜3: å†…å­˜å ç”¨è¿‡é«˜**
```dart
// âœ… è§£å†³æ–¹æ¡ˆï¼šä¸»åŠ¨æ¸…ç†ä½ä¼˜å…ˆçº§ç¼“å­˜
await cacheManager.removeWhere((key, value) {
  return value.priority == CachePriority.low;
});
```

#### 5.4.2 è°ƒè¯•å·¥å…·å’ŒæŠ€å·§

```dart
// å¯ç”¨è°ƒè¯•æ—¥å¿—
AppLogger.level = LogLevel.debug;

// ç¼“å­˜å†…å®¹æ£€æŸ¥
final cacheKeys = await cacheManager.getAllKeys();
for (final key in cacheKeys.take(10)) {
  final value = cacheManager.get(key);
  print('Cache[$key]: $value');
}

// ç¼“å­˜æ€§èƒ½æµ‹è¯•
final stopwatch = Stopwatch()..start();
await cacheManager.put('test:key', testData);
stopwatch.stop();
print('å†™å…¥è€—æ—¶: ${stopwatch.elapsedMilliseconds}ms');
```

### 5.5 å‡çº§å’Œç»´æŠ¤è®¡åˆ’

#### 5.5.1 çŸ­æœŸè®¡åˆ’ (1-3å¤©)

1. **ä¾èµ–æ³¨å…¥é‡æ„**
   - ç»Ÿä¸€ä½¿ç”¨ `UnifiedHiveCacheManager`
   - ç§»é™¤é‡å¤ç¼“å­˜ç®¡ç†å™¨æ³¨å†Œ
   - æ›´æ–°ç›¸å…³æ¨¡å—å¼•ç”¨

2. **åˆ é™¤å†—ä½™æ–‡ä»¶**
   - åˆ é™¤é‡å¤çš„ç¼“å­˜å®ç°æ–‡ä»¶
   - æ›´æ–°å¯¼å…¥è¯­å¥
   - éªŒè¯ç¼–è¯‘å’ŒåŠŸèƒ½

#### 5.5.2 ä¸­æœŸè®¡åˆ’ (1-2å‘¨)

1. **ç¼“å­˜æ ‡å‡†åŒ–**
   - ç»Ÿä¸€ç¼“å­˜é”®å‘½åè§„èŒƒ
   - æ ‡å‡†åŒ–è¿‡æœŸæ—¶é—´ç­–ç•¥
   - å®ç°ç»Ÿä¸€çš„ç›‘æ§ä½“ç³»

2. **æ€§èƒ½ä¼˜åŒ–**
   - ä¼˜åŒ–ç¼“å­˜å‘½ä¸­ç‡
   - å‡å°‘å†…å­˜å ç”¨
   - æå‡æ‰¹é‡æ“ä½œæ€§èƒ½

#### 5.5.3 é•¿æœŸè®¡åˆ’ (1ä¸ªæœˆ)

1. **æ™ºèƒ½åŒ–å‡çº§**
   - å®ç°æœºå™¨å­¦ä¹ é©±åŠ¨çš„ç¼“å­˜ç­–ç•¥
   - æ™ºèƒ½é¢„åŠ è½½æœºåˆ¶
   - åŠ¨æ€æ€§èƒ½è°ƒä¼˜

2. **ç›‘æ§å®Œå–„**
   - å®æ—¶ç›‘æ§é¢æ¿
   - å¼‚å¸¸å‘Šè­¦ç³»ç»Ÿ
   - æ€§èƒ½åˆ†ææŠ¥å‘Š

---

## 6. æ€»ç»“å’Œå»ºè®®

### 6.1 å½“å‰æ¶æ„è¯„ä¼°

**ä¼˜åŠ¿:**
- âœ… å·²å®ç°å®Œæ•´çš„ä¸‰å±‚ç¼“å­˜æ¶æ„
- âœ… ç»Ÿä¸€ç¼“å­˜ç®¡ç†å™¨åŠŸèƒ½å®Œå–„
- âœ… å…·å¤‡å®Œæ•´çš„å®¹é”™æœºåˆ¶
- âœ… æ”¯æŒæ™ºèƒ½ç¼“å­˜ç­–ç•¥

**éœ€è¦æ”¹è¿›:**
- âŒ å­˜åœ¨å¤§é‡é‡å¤çš„ç¼“å­˜å®ç°
- âŒ ç¼“å­˜å‘½åå’Œä½¿ç”¨è§„èŒƒä¸ç»Ÿä¸€
- âŒ ç¼ºä¹ç»Ÿä¸€çš„ç›‘æ§ä½“ç³»
- âŒ æ€§èƒ½ä¼˜åŒ–ç©ºé—´è¾ƒå¤§

### 6.2 å…³é”®å»ºè®®

1. **ç«‹å³è¡ŒåŠ¨:**
   - ä½¿ç”¨ `UnifiedHiveCacheManager` ä½œä¸ºå”¯ä¸€ç¼“å­˜ç®¡ç†å™¨
   - åˆ é™¤æ‰€æœ‰é‡å¤çš„ç¼“å­˜å®ç°æ–‡ä»¶
   - ç»Ÿä¸€ç¼“å­˜é”®å‘½åè§„èŒƒ

2. **æŒç»­æ”¹è¿›:**
   - å»ºç«‹ç¼“å­˜æ€§èƒ½ç›‘æ§ä½“ç³»
   - å®šæœŸè¿›è¡Œç¼“å­˜æ€§èƒ½è¯„ä¼°
   - æ ¹æ®ä¸šåŠ¡å‘å±•è°ƒæ•´ç¼“å­˜ç­–ç•¥

3. **é•¿æœŸè§„åˆ’:**
   - è€ƒè™‘å¼•å…¥åˆ†å¸ƒå¼ç¼“å­˜æ”¯æŒ
   - æ¢ç´¢AIé©±åŠ¨çš„æ™ºèƒ½ç¼“å­˜ç­–ç•¥
   - å»ºç«‹å®Œå–„çš„ç¼“å­˜æ²»ç†ä½“ç³»

---

## 7. å‚è€ƒæ–‡æ¡£

- [ä¸‰å±‚ç¼“å­˜æ¶æ„ï¼ˆL1+L2+L3ï¼‰è¯¦ç»†è®¾è®¡ä¸å®æ–½æ–‡æ¡£](ä¸‰å±‚ç¼“å­˜æ¶æ„ï¼ˆL1+L2+L3ï¼‰è¯¦ç»†è®¾è®¡ä¸å®æ–½æ–‡æ¡£åœ¨åŸºé‡‘æ¢ç´¢ç•Œé¢é‡æ„å®Œå.md)
- [Hive å®˜æ–¹æ–‡æ¡£](https://docs.hivedb.dev/)
- [Dio HTTP Cache æ’ä»¶æ–‡æ¡£](https://pub.dev/packages/dio_http_cache_lts)
- [Flutter å®˜æ–¹æ€§èƒ½æœ€ä½³å®è·µ](https://flutter.dev/docs/perf)

---

**æ–‡æ¡£ç»´æŠ¤:** æœ¬æ–‡æ¡£åº”éšç€é¡¹ç›®æ¶æ„æ¼”è¿›å®šæœŸæ›´æ–°ï¼Œå»ºè®®æ¯ä¸ªç‰ˆæœ¬è¿­ä»£åè¿›è¡Œå®¡æŸ¥å’Œæ›´æ–°ã€‚

**è”ç³»æ–¹å¼:** å¦‚æœ‰ç¼“å­˜æ¶æ„ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æŸ¥é˜…ç›¸å…³æŠ€æœ¯æ–‡æ¡£ã€‚