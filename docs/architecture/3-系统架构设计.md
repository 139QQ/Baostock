# 3. 系统架构设计

### 3.1 整体架构图
```
┌─────────────────────────────────────────────────────────────┐
│                    用户界面层 (Flutter UI)                    │
├─────────────────────────────────────────────────────────────┤
│                   业务逻辑层 (BLoC Pattern)                  │
├─────────────────────────────────────────────────────────────┤
│    数据访问层     │     数据访问层     │     数据访问层        │
│   (API Client)   │   (Local Cache)   │   (Database)       │
├─────────────────────────────────────────────────────────────┤
│                  基础设施层 (Network/Storage)               │
├─────────────────────────────────────────────────────────────┤
│         外部服务层 (AKShare API /自建API服务)               │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 模块架构
系统采用功能模块化设计，主要模块包括：

#### 3.2.1 核心模块 (Core)
- **网络模块** (`core/network/`): API客户端、网络配置、错误处理
- **缓存模块** (`core/cache/`): Hive缓存管理、数据同步策略
- **数据库模块** (`core/database/`): SQL Server连接、数据访问对象
- **依赖注入** (`core/di/`): 服务定位器、模块依赖管理
- **主题管理** (`core/theme/`): 应用主题、样式统一管理
- **工具模块** (`core/utils/`): 日志、格式化、验证工具

#### 3.2.2 功能模块 (Features)
- **基金排行** (`features/fund/`): 基金列表、排行、筛选功能
- **基金探索** (`features/fund_exploration/`): 基金发现、推荐、搜索
- **首页** (`features/home/`): 仪表板、市场概览、用户关注
- **市场数据** (`features/market/`): 市场行情、指数数据
- **组合管理** (`features/portfolio/`): 自定义组合、业绩分析
- **数据中心** (`features/data_center/`): 数据分析、报表导出
- **提醒通知** (`features/alerts/`): 价格提醒、公告通知
- **设置** (`features/settings/`): 用户偏好、系统配置
- **导航** (`features/navigation/`): 路由管理、页面导航

### 3.3 数据流架构
系统采用单向数据流模式，确保状态管理的可预测性：

```
User Action → BLoC Event → Business Logic → Repository → Data Source
     ↑                                                        ↓
     └────────────── State Update ←─────── Data Response ←──┘
```

#### 3.3.1 数据获取策略
1. **缓存优先**: 优先从本地缓存获取数据，提升响应速度
2. **网络更新**: 后台异步更新网络数据，保证数据新鲜度
3. **降级机制**: 网络不可用时，完全依赖本地缓存数据
4. **增量更新**: 只更新变更的数据，减少网络传输

#### 3.3.2 数据同步机制
- **实时同步**: 用户主动操作时立即触发数据更新
- **定时同步**: 后台定时任务更新缓存数据（15分钟间隔）
- **智能预加载**: 基于用户行为预测，提前加载可能需要的数据
