# Story R.2: æœåŠ¡å±‚é‡æ„ - ä»»åŠ¡åˆ†è§£

## ğŸ“‹ Storyæ¦‚è¿°
**Story ID**: Story R.2
**æ ‡é¢˜**: æœåŠ¡å±‚é‡æ„å®æ–½
**é¢„ä¼°æ€»æ—¶é•¿**: 12å°æ—¶
**å›¢é˜Ÿ**: æ¶æ„å¸ˆ + é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
**çŠ¶æ€**: ğŸŸ¡ å‡†å¤‡å®æ–½

## ğŸ¯ Storyç›®æ ‡
é‡æ„æœåŠ¡å±‚æ¶æ„ï¼Œè§£å†³å½“å‰19ä¸ªServiceç±»çš„èŒè´£é‡å å’ŒåŠŸèƒ½é‡å¤é—®é¢˜ï¼Œå»ºç«‹æ¸…æ™°çš„æœåŠ¡åˆ†å±‚æ¶æ„ã€‚

## ğŸš¨ å…³é”®é—®é¢˜
- åŸºé‡‘æœç´¢åŠŸèƒ½åœ¨3ä¸ªServiceä¸­é‡å¤å®ç°
- ç¼“å­˜ç®¡ç†åœ¨4ä¸ªServiceä¸­é‡å¤
- æœåŠ¡é—´ä¾èµ–å…³ç³»æ··ä¹±
- ç¼ºä¹ç»Ÿä¸€çš„æœåŠ¡æ¥å£æ ‡å‡†

## ğŸ“Š ä»»åŠ¡åˆ†è§£

### Task R.2.1: æœåŠ¡ç°çŠ¶è°ƒç ”ä¸åˆ†ç±» (2å°æ—¶)
- **å®æ–½å†…å®¹**:
  - åˆ†æç°æœ‰19ä¸ªServiceç±»çš„èŒè´£å’ŒåŠŸèƒ½
  - è¯†åˆ«æœåŠ¡é—´çš„ä¾èµ–å…³ç³»å’Œè°ƒç”¨é“¾
  - åˆ†ç±»æœåŠ¡ç±»å‹ï¼ˆæ ¸å¿ƒæœåŠ¡ã€å·¥å…·æœåŠ¡ã€ä¸šåŠ¡æœåŠ¡ï¼‰
  - è¯†åˆ«é‡å¤åŠŸèƒ½å’Œå†—ä½™æœåŠ¡
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] å®ŒæˆæœåŠ¡åŠŸèƒ½åˆ†ç±»æŠ¥å‘Š
  - [ ] ç»˜åˆ¶æœåŠ¡ä¾èµ–å…³ç³»å›¾
  - [ ] è¯†åˆ«5ä¸ªæ ¸å¿ƒé‡å¤åŠŸèƒ½
  - [ ] åˆ¶å®šæœåŠ¡åˆå¹¶ç­–ç•¥
- **ä¾èµ–å…³ç³»**: Story R.1å®Œæˆ
- **é£é™©ç‚¹**: æœåŠ¡ä¾èµ–å…³ç³»å¤æ‚ï¼Œåˆ†æå›°éš¾
- **ç¼“è§£æªæ–½**: ä½¿ç”¨ä¾èµ–åˆ†æå·¥å…· + ä»£ç å®¡æŸ¥

### Task R.2.2: æ ¸å¿ƒæœåŠ¡åˆå¹¶å®æ–½ (4å°æ—¶)
- **å®æ–½å†…å®¹**:
  - å®æ–½ç»Ÿä¸€åŸºé‡‘æœåŠ¡ `UnifiedFundService`
  - åˆå¹¶é‡å¤çš„æœç´¢åŠŸèƒ½
  - é‡æ„ç¼“å­˜ç®¡ç†æœåŠ¡
  - å»ºç«‹æœåŠ¡æ¥å£æŠ½è±¡å±‚
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] å®Œæˆ3ä¸ªæ ¸å¿ƒæœåŠ¡åˆå¹¶
  - [ ] ç»Ÿä¸€æœç´¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ
  - [ ] ç¼“å­˜ç®¡ç†æœåŠ¡é‡æ„å®Œæˆ
  - [ ] æœåŠ¡æ¥å£æŠ½è±¡å±‚å°±ä½
- **ä¾èµ–å…³ç³»**: R.2.1
- **é£é™©ç‚¹**: æœåŠ¡åˆå¹¶å¯¼è‡´åŠŸèƒ½ç¼ºå¤±
- **ç¼“è§£æªæ–½**: æ¸è¿›å¼åˆå¹¶ + Feature Toggle

### Task R.2.3: API Gatewayæ¨¡å¼å®æ–½ (3å°æ—¶)
- **å®æ–½å†…å®¹**:
  - è®¾è®¡å’Œå®ç°API Gateway
  - å»ºç«‹æœåŠ¡è·¯ç”±æœºåˆ¶
  - å®æ–½ç»Ÿä¸€çš„è¯·æ±‚/å“åº”å¤„ç†
  - å»ºç«‹æœåŠ¡ç›‘æ§å’Œæ—¥å¿—æœºåˆ¶
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] API Gatewayæ­£å¸¸å·¥ä½œ
  - [ ] æœåŠ¡è·¯ç”±æœºåˆ¶å‡†ç¡®
  - [ ] ç»Ÿä¸€å¼‚å¸¸å¤„ç†å°±ä½
  - [ ] æœåŠ¡ç›‘æ§æœºåˆ¶è¿è¡Œ
- **ä¾èµ–å…³ç³»**: R.2.2
- **é£é™©ç‚¹**: Gatewayæˆä¸ºå•ç‚¹æ•…éšœ
- **ç¼“è§£æªæ–½**: é«˜å¯ç”¨è®¾è®¡ + å¿«é€Ÿé™çº§æœºåˆ¶

### Task R.2.4: æœåŠ¡ä¾èµ–æ³¨å…¥é‡æ„ (2å°æ—¶)
- **å®æ–½å†…å®¹**:
  - æ›´æ–°ä¾èµ–æ³¨å…¥é…ç½®
  - é‡æ„æœåŠ¡åˆå§‹åŒ–æµç¨‹
  - å®æ–½æœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - å»ºç«‹æœåŠ¡å¥åº·æ£€æŸ¥æœºåˆ¶
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] ä¾èµ–æ³¨å…¥æ­£ç¡®é…ç½®
  - [ ] æœåŠ¡åˆå§‹åŒ–æµç¨‹ä¼˜åŒ–
  - [ ] æœåŠ¡ç”Ÿå‘½å‘¨æœŸæ­£å¸¸
  - [ ] å¥åº·æ£€æŸ¥æœºåˆ¶è¿è¡Œ
- **ä¾èµ–å…³ç³»**: R.2.3
- **é£é™©ç‚¹**: ä¾èµ–æ³¨å…¥é…ç½®é”™è¯¯
- **ç¼“è§£æªæ–½**: è‡ªåŠ¨åŒ–æµ‹è¯• + é…ç½®éªŒè¯

### Task R.2.5: æœåŠ¡å±‚æµ‹è¯•ä¸éªŒè¯ (1å°æ—¶)
- **å®æ–½å†…å®¹**:
  - ç¼–å†™æœåŠ¡å±‚å•å…ƒæµ‹è¯•
  - æ‰§è¡ŒæœåŠ¡é›†æˆæµ‹è¯•
  - æ€§èƒ½å’Œè´Ÿè½½æµ‹è¯•
  - æœåŠ¡å¯ç”¨æ€§æµ‹è¯•
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 85%
  - [ ] é›†æˆæµ‹è¯•é€šè¿‡
  - [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
  - [ ] æœåŠ¡å¯ç”¨æ€§ > 99.5%
- **ä¾èµ–å…³ç³»**: R.2.4
- **é£é™©ç‚¹**: æµ‹è¯•è¦†ç›–ä¸å……åˆ†
- **ç¼“è§£æªæ–½**: å¤šç»´åº¦æµ‹è¯• + ä»£ç å®¡æŸ¥

## ğŸ“ æ–‡ä»¶ä½ç½®
- **æœåŠ¡å±‚å®ç°**: `lib/src/core/services/`
- **API Gateway**: `lib/src/core/gateway/`
- **æœåŠ¡æµ‹è¯•**: `test/unit/core/services/`
- **æœåŠ¡æ–‡æ¡£**: `docs/story-r2-service-refactor/docs/`

## ğŸ”§ å…³é”®ä»£ç ä½ç½®
- **é‡å¤æœç´¢æœåŠ¡**: `lib/src/services/fund_search_service.dart`
- **ç¼“å­˜æœåŠ¡**: `lib/src/core/cache/`
- **æœåŠ¡ä¾èµ–æ³¨å…¥**: `lib/src/core/di/injection_container.dart`

## ğŸ¯ æœåŠ¡æ¶æ„ç›®æ ‡

### åˆå¹¶å‰ (19ä¸ªServiceç±»)
```
fund_search_service.dart     â†’ åˆå¹¶åˆ° unified_fund_service.dart
fund_data_service.dart       â†’ åˆå¹¶åˆ° unified_fund_service.dart
fund_analysis_service.dart   â†’ ä¿ç•™ä¸ºæ ¸å¿ƒæœåŠ¡
portfolio_service.dart       â†’ é‡æ„ä¸º business_service.dart
cache_service.dart           â†’ åˆå¹¶åˆ° unified_cache_service.dart
user_service.dart            â†’ é‡æ„ä¸º user_domain_service.dart
...
```

### åˆå¹¶å (8ä¸ªæ ¸å¿ƒæœåŠ¡)
```
UnifiedFundService          - åŸºé‡‘æ ¸å¿ƒä¸šåŠ¡æœåŠ¡
UnifiedCacheService         - ç»Ÿä¸€ç¼“å­˜æœåŠ¡
BusinessAnalysisService     - ä¸šåŠ¡åˆ†ææœåŠ¡
UserDomainService          - ç”¨æˆ·é¢†åŸŸæœåŠ¡
PortfolioService           - æŠ•èµ„ç»„åˆæœåŠ¡
MarketDataService          - å¸‚åœºæ•°æ®æœåŠ¡
NotificationService        - é€šçŸ¥æœåŠ¡
ConfigService              - é…ç½®æœåŠ¡
```

## âœ… éªŒæ”¶æ ‡å‡†æ€»è§ˆ
1. **æŠ€æœ¯æŒ‡æ ‡**:
   - [ ] Serviceç±»ä»19ä¸ªå‡å°‘åˆ°8ä¸ª
   - [ ] ä»£ç é‡å¤ç‡é™ä½åˆ° < 8%
   - [ ] æœåŠ¡æ¥å£æ ‡å‡†åŒ– 100%

2. **æ€§èƒ½æŒ‡æ ‡**:
   - [ ] APIå“åº”æ—¶é—´æå‡ > 25%
   - [ ] æœåŠ¡è°ƒç”¨å»¶è¿Ÿé™ä½ > 30%
   - [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ– > 20%

3. **è´¨é‡æŒ‡æ ‡**:
   - [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 85%
   - [ ] é›†æˆæµ‹è¯•é€šè¿‡ç‡ 100%
   - [ ] æœåŠ¡å¯ç”¨æ€§ > 99.5%

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. ç­‰å¾…Story R.1çŠ¶æ€ç®¡ç†ç»Ÿä¸€å®Œæˆ
2. å‡†å¤‡æœåŠ¡å±‚åˆ†æå·¥å…·å’Œç¯å¢ƒ
3. åˆ¶å®šè¯¦ç»†çš„æœåŠ¡åˆå¹¶æ—¶é—´è¡¨
4. å»ºç«‹æœåŠ¡é‡æ„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

---
*æœåŠ¡å±‚é‡æ„å°†æ˜¾è‘—æå‡ç³»ç»Ÿæ¶æ„çš„æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§ï¼Œä¸ºåç»­åŠŸèƒ½å¼€å‘å¥ å®šåšå®åŸºç¡€ã€‚*