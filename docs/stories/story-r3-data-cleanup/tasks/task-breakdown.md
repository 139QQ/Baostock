# Story R.3: æ•°æ®å±‚æ¸…ç† - ä»»åŠ¡åˆ†è§£

## ğŸ“‹ Storyæ¦‚è¿°
**Story ID**: Story R.3
**æ ‡é¢˜**: æ•°æ®å±‚æ¸…ç†ä¸Repositoryæ¨¡å¼å®æ–½
**é¢„ä¼°æ€»æ—¶é•¿**: 10å°æ—¶
**å›¢é˜Ÿ**: æ•°æ®æ¶æ„å¸ˆ + åç«¯å¼€å‘å·¥ç¨‹å¸ˆ
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜ - æ•°æ®æŒä¹…åŒ–å±‚é‡æ„
**çŠ¶æ€**: ğŸŸ¡ å‡†å¤‡å®æ–½

## ğŸ¯ Storyç›®æ ‡
æ¸…ç†æ•°æ®å±‚æ¶æ„ï¼Œå®æ–½Repositoryæ¨¡å¼ï¼Œè§£å†³å½“å‰27ä¸ªManagerç±»çš„åŠŸèƒ½é‡å é—®é¢˜ï¼Œå»ºç«‹ç»Ÿä¸€çš„æ•°æ®è®¿é—®å±‚ã€‚

## ğŸš¨ å…³é”®é—®é¢˜
- Managerç±»èŒè´£ä¸æ¸…æ™°ï¼ŒåŠŸèƒ½é‡å ä¸¥é‡
- ç¼“å­˜ç­–ç•¥åˆ†æ•£åœ¨å¤šä¸ªManagerä¸­
- æ•°æ®è®¿é—®ç¼ºä¹ç»Ÿä¸€æ¥å£
- æ•°æ®æºç®¡ç†æ··ä¹±

## ğŸ“Š ä»»åŠ¡åˆ†è§£

### Task R.3.1: Managerç±»ç°çŠ¶åˆ†æ (2å°æ—¶)
- **å®æ–½å†…å®¹**:
  - åˆ†æç°æœ‰27ä¸ªManagerç±»çš„åŠŸèƒ½å’ŒèŒè´£
  - è¯†åˆ«Managerç±»é—´çš„ä¾èµ–å…³ç³»
  - åˆ†ç±»Managerç±»ç±»å‹ï¼ˆç¼“å­˜ã€ä¸šåŠ¡ã€æ•°æ®ã€å·¥å…·ï¼‰
  - è¯†åˆ«å¯åˆå¹¶çš„é‡å¤åŠŸèƒ½
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] å®ŒæˆManagerç±»åŠŸèƒ½åˆ†ç±»æŠ¥å‘Š
  - [ ] ç»˜åˆ¶Managerä¾èµ–å…³ç³»å›¾
  - [ ] è¯†åˆ«6ä¸ªæ ¸å¿ƒé‡å¤åŠŸèƒ½
  - [ ] åˆ¶å®šManageråˆå¹¶ç­–ç•¥
- **ä¾èµ–å…³ç³»**: Story R.2å®Œæˆ
- **é£é™©ç‚¹**: Managerç±»åŠŸèƒ½å¤æ‚ï¼Œåˆ†æé—æ¼
- **ç¼“è§£æªæ–½**: é™æ€åˆ†æå·¥å…· + è¯¦ç»†ä»£ç å®¡æŸ¥

### Task R.3.2: Repositoryæ¨¡å¼å®æ–½ (3å°æ—¶)
- **å®æ–½å†…å®¹**:
  - è®¾è®¡ç»Ÿä¸€çš„Repositoryæ¥å£
  - å®ç°æ•°æ®æºæŠ½è±¡å±‚
  - å»ºç«‹Repositoryå·¥å‚æ¨¡å¼
  - å®æ–½æ•°æ®è®¿é—®ä»£ç†æ¨¡å¼
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] Repositoryæ¥å£è®¾è®¡å®Œæˆ
  - [ ] 3ä¸ªæ ¸å¿ƒRepositoryå®ç°å®Œæˆ
  - [ ] æ•°æ®æºæŠ½è±¡å±‚å°±ä½
  - [ ] Repositoryå·¥å‚æ­£å¸¸å·¥ä½œ
- **ä¾èµ–å…³ç³»**: R.3.1
- **é£é™©ç‚¹**: Repositoryè®¾è®¡è¿‡äºå¤æ‚
- **ç¼“è§£æªæ–½**: æ¸è¿›å¼å®ç° + æŒç»­é‡æ„

### Task R.3.3: ç¼“å­˜ç®¡ç†ç»Ÿä¸€åŒ– (2å°æ—¶)
- **å®æ–½å†…å®¹**:
  - ç»Ÿä¸€ç¼“å­˜ç­–ç•¥å’Œé…ç½®
  - é‡æ„Hiveç¼“å­˜ç®¡ç†
  - å®æ–½å¤šçº§ç¼“å­˜æ¶æ„
  - å»ºç«‹ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] ç»Ÿä¸€ç¼“å­˜é…ç½®å®Œæˆ
  - [ ] Hiveç¼“å­˜ç®¡ç†é‡æ„
  - [ ] ä¸‰çº§ç¼“å­˜æ¶æ„è¿è¡Œ
  - [ ] ç¼“å­˜ä¸€è‡´æ€§ä¿è¯
- **ä¾èµ–å…³ç³»**: R.3.2
- **é£é™©ç‚¹**: ç¼“å­˜ä¸€è‡´æ€§éš¾ä»¥ä¿è¯
- **ç¼“è§£æªæ–½**: ç‰ˆæœ¬æ§åˆ¶ + å¤±æ•ˆç­–ç•¥

### Task R.3.4: Managerç±»åˆå¹¶é‡æ„ (2å°æ—¶)
- **å®æ–½å†…å®¹**:
  - åˆå¹¶é‡å¤çš„ç¼“å­˜Managerç±»
  - é‡æ„æ•°æ®è®¿é—®Manager
  - æ¸…ç†åºŸå¼ƒçš„Managerç±»
  - æ›´æ–°ç›¸å…³ä¾èµ–å’Œè°ƒç”¨
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] é‡å¤Managerç±»åˆå¹¶å®Œæˆ
  - [ ] æ•°æ®è®¿é—®Manageré‡æ„
  - [ ] åºŸå¼ƒä»£ç æ¸…ç†å®Œæ¯•
  - [ ] ä¾èµ–å…³ç³»æ›´æ–°å®Œæˆ
- **ä¾èµ–å…³ç³»**: R.3.3
- **é£é™©ç‚¹**: é‡æ„ç ´åç°æœ‰åŠŸèƒ½
- **ç¼“è§£æªæ–½**: å…¨é¢æµ‹è¯• + æ¸è¿›å¼é‡æ„

### Task R.3.5: æ•°æ®å±‚æµ‹è¯•ä¸éªŒè¯ (1å°æ—¶)
- **å®æ–½å†…å®¹**:
  - ç¼–å†™Repositoryå±‚å•å…ƒæµ‹è¯•
  - æ‰§è¡Œæ•°æ®ä¸€è‡´æ€§æµ‹è¯•
  - æ€§èƒ½å’Œè´Ÿè½½æµ‹è¯•
  - æ•°æ®å®Œæ•´æ€§éªŒè¯
- **éªŒæ”¶æ ‡å‡†**:
  - [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%
  - [ ] æ•°æ®ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡
  - [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
  - [ ] æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡
- **ä¾èµ–å…³ç³»**: R.3.4
- **é£é™©ç‚¹**: æ•°æ®è¿ç§»é£é™©
- **ç¼“è§£æªæ–½**: å¤‡ä»½ç­–ç•¥ + å›æ»šæœºåˆ¶

## ğŸ“ æ–‡ä»¶ä½ç½®
- **Repositoryå®ç°**: `lib/src/core/repositories/`
- **æ•°æ®æºæŠ½è±¡**: `lib/src/core/datasources/`
- **ç¼“å­˜ç®¡ç†**: `lib/src/core/cache/`
- **æ•°æ®å±‚æµ‹è¯•**: `test/unit/core/repositories/`
- **æ•°æ®å±‚æ–‡æ¡£**: `docs/story-r3-data-cleanup/docs/`

## ğŸ”§ å…³é”®ä»£ç ä½ç½®
- **é‡å¤Managerç±»**: `lib/src/managers/cache_manager.dart`, `lib/src/managers/data_manager.dart`
- **Hiveç¼“å­˜**: `lib/src/core/cache/hive_cache_manager.dart`
- **æ•°æ®è®¿é—®**: `lib/src/data/`

## ğŸ¯ æ•°æ®å±‚æ¶æ„ç›®æ ‡

### Managerç±»æ¸…ç†å‰ (27ä¸ªManagerç±»)
```
CacheManager              â†’ åˆå¹¶åˆ° UnifiedCacheRepository
DataManager               â†’ åˆå¹¶åˆ° DomainRepository
UserManager              â†’ é‡æ„ä¸º UserRepository
PortfolioManager         â†’ ä¿ç•™ä¸ºä¸šåŠ¡Repository
ConfigManager            â†’ åˆå¹¶åˆ° SystemRepository
NetworkManager           â†’ é‡æ„ä¸º NetworkRepository
...
```

### Repositoryæ¶æ„å®æ–½å (8ä¸ªæ ¸å¿ƒRepository)
```
UnifiedCacheRepository    - ç»Ÿä¸€ç¼“å­˜Repository
FundRepository           - åŸºé‡‘æ•°æ®Repository
UserRepository           - ç”¨æˆ·æ•°æ®Repository
PortfolioRepository      - æŠ•èµ„ç»„åˆRepository
MarketRepository         - å¸‚åœºæ•°æ®Repository
SystemRepository         - ç³»ç»Ÿé…ç½®Repository
NetworkRepository        - ç½‘ç»œè®¿é—®Repository
FileRepository           - æ–‡ä»¶ç®¡ç†Repository
```

## ğŸ—ï¸ Repositoryæ¨¡å¼è®¾è®¡

### æ¥å£å±‚
```dart
abstract class IRepository<T> {
  Future<List<T>> getAll();
  Future<T?> getById(String id);
  Future<List<T>> search(Map<String, dynamic> criteria);
  Future<void> save(T item);
  Future<void> delete(String id);
}
```

### æ•°æ®æºå±‚
```dart
abstract class IDataSource<T> {
  Future<List<T>> fetch();
  Future<void> persist(List<T> items);
  Future<void> clear();
}

class HiveDataSource<T> implements IDataSource<T> { ... }
class RemoteDataSource<T> implements IDataSource<T> { ... }
```

### Repositoryå®ç°
```dart
class FundRepository implements IRepository<Fund> {
  final IDataSource<Fund> _cacheDataSource;
  final IDataSource<Fund> _remoteDataSource;

  // ç»Ÿä¸€çš„åŸºé‡‘æ•°æ®è®¿é—®é€»è¾‘
}
```

## âœ… éªŒæ”¶æ ‡å‡†æ€»è§ˆ
1. **æŠ€æœ¯æŒ‡æ ‡**:
   - [ ] Managerç±»ä»27ä¸ªå‡å°‘åˆ°8ä¸ª
   - [ ] Repositoryæ¥å£æ ‡å‡†åŒ– 100%
   - [ ] ç¼“å­˜ç»Ÿä¸€åŒ–å®Œæˆ
   - [ ] ä»£ç é‡å¤ç‡ < 5%

2. **æ€§èƒ½æŒ‡æ ‡**:
   - [ ] æ•°æ®è®¿é—®æ€§èƒ½æå‡ > 30%
   - [ ] ç¼“å­˜å‘½ä¸­ç‡ > 80%
   - [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ– > 25%
   - [ ] æ•°æ®ä¸€è‡´æ€§ä¿è¯ 100%

3. **è´¨é‡æŒ‡æ ‡**:
   - [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%
   - [ ] æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡
   - [ ] è¿ç§»è¿‡ç¨‹é›¶æ•°æ®ä¸¢å¤±

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. ç­‰å¾…Story R.2æœåŠ¡å±‚é‡æ„å®Œæˆ
2. å‡†å¤‡æ•°æ®å±‚åˆ†æå·¥å…·
3. åˆ¶å®šè¯¦ç»†çš„æ•°æ®è¿ç§»è®¡åˆ’
4. å»ºç«‹æ•°æ®å±‚ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

---
*æ•°æ®å±‚æ¸…ç†å°†å»ºç«‹æ¸…æ™°ã€é«˜æ•ˆã€å¯æ‰©å±•çš„æ•°æ®è®¿é—®æ¶æ„ï¼Œä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šè¿è¡Œæä¾›åšå®åŸºç¡€ã€‚*