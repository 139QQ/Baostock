# å¸‚åœºæŒ‡æ•°å†å²æ•°æ®APIå®ç°æ–‡æ¡£

## æ¦‚è¿°

åŸºäºä¸œæ–¹è´¢å¯ŒAPIæ–‡æ¡£ï¼Œé¡¹ç›®å·²æˆåŠŸè¡¥å……äº†å®Œæ•´çš„å†å²æŒ‡æ•°æ•°æ®è·å–åŠŸèƒ½ï¼Œæ”¯æŒå®æ—¶æ•°æ®ä¸å†å²æ•°æ®çš„åŒºåˆ†ä½¿ç”¨ã€‚

## å®ç°çš„åŠŸèƒ½

### âœ… å·²å®ç°åŠŸèƒ½

1. **å†å²æ—¥çº¿æ•°æ®è·å–**
   - APIç«¯ç‚¹: `/api/public/stock_zh_index_daily_em`
   - æ”¯æŒæ—¥æœŸèŒƒå›´è¿‡æ»¤
   - å®Œæ•´çš„OHLCVæ•°æ®ï¼ˆå¼€ç›˜ã€æœ€é«˜ã€æœ€ä½ã€æ”¶ç›˜ã€æˆäº¤é‡ã€æˆäº¤é¢ï¼‰

2. **åˆ†æ—¶å†å²æ•°æ®è·å–**
   - APIç«¯ç‚¹: `/api/public/index_zh_a_hist_min_em`
   - æ”¯æŒå¤šç§æ—¶é—´å‘¨æœŸ: 1, 5, 15, 30, 60åˆ†é’Ÿ
   - ç²¾ç¡®çš„æ—¶é—´å‚æ•°æ”¯æŒ
   - é«˜é¢‘æ•°æ®ç¼“å­˜ç­–ç•¥

3. **æ—¶é—´å‚æ•°å¤„ç†æœºåˆ¶**
   - æ™ºèƒ½æ—¥æœŸæ ¼å¼åŒ–
   - å¼€å§‹æ—¶é—´/ç»“æŸæ—¶é—´è¿‡æ»¤
   - åˆ†æ—¶æ•°æ®ä¸æ—¥çº¿æ•°æ®çš„æ—¶é—´æ ¼å¼é€‚é…

4. **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**
   - å†å²æ•°æ®: 1å°æ—¶ç¼“å­˜
   - åˆ†æ—¶æ•°æ®: 5åˆ†é’Ÿç¼“å­˜
   - åŸºäºæ•°æ®æ›´æ–°é¢‘ç‡çš„å·®å¼‚åŒ–ç¼“å­˜

## æ–°å¢çš„ç±»å’Œæ¥å£

### 1. IndexHistoryData - æŒ‡æ•°å†å²æ•°æ®æ¨¡å‹
```dart
class IndexHistoryData {
  final String symbol;      // æŒ‡æ•°ä»£ç 
  final String name;        // æŒ‡æ•°åç§°
  final DateTime date;      // æ—¥æœŸ
  final double open;        // å¼€ç›˜ä»·
  final double high;        // æœ€é«˜ä»·
  final double low;         // æœ€ä½ä»·
  final double close;       // æ”¶ç›˜ä»·
  final int volume;         // æˆäº¤é‡
  final double amount;      // æˆäº¤é¢

  // è®¡ç®—å±æ€§
  double get changePercent; // æ¶¨è·Œå¹…
  double get changeAmount;  // æ¶¨è·Œé¢
}
```

### 2. IndexIntradayData - æŒ‡æ•°åˆ†æ—¶æ•°æ®æ¨¡å‹
```dart
class IndexIntradayData {
  final String symbol;      // æŒ‡æ•°ä»£ç 
  final String name;        // æŒ‡æ•°åç§°
  final DateTime time;      // æ—¶é—´
  final double open;        // å¼€ç›˜ä»·
  final double close;       // æ”¶ç›˜ä»·
  final double high;        // æœ€é«˜ä»·
  final double low;         // æœ€ä½ä»·
  final int volume;         // æˆäº¤é‡
  final double amount;      // æˆäº¤é¢
  final double avgPrice;    // å‡ä»·
}
```

### 3. HistoryQueryParams - æŸ¥è¯¢å‚æ•°å°è£…
```dart
class HistoryQueryParams {
  final String symbol;           // æŒ‡æ•°ä»£ç 
  final DateTime? startDate;     // å¼€å§‹æ—¥æœŸ
  final DateTime? endDate;       // ç»“æŸæ—¥æœŸ
  final String? period;          // æ—¶é—´å‘¨æœŸ (ç”¨äºåˆ†æ—¶æ•°æ®)

  Map<String, dynamic> toQueryParams(); // è½¬æ¢ä¸ºAPIå‚æ•°
}
```

## APIè°ƒç”¨æ–¹å¼

### 1. å†å²æ—¥çº¿æ•°æ®
```dart
final params = HistoryQueryParams(
  symbol: '000001', // ä¸Šè¯æŒ‡æ•°
  startDate: DateTime.now().subtract(Duration(days: 30)),
  endDate: DateTime.now(),
);

final historyData = await marketService.getIndexHistory(params);
```

### 2. åˆ†æ—¶æ•°æ®
```dart
final params = HistoryQueryParams(
  symbol: '000001', // ä¸Šè¯æŒ‡æ•°
  period: '1',      // 1åˆ†é’Ÿçº§åˆ«
  startDate: DateTime(2023, 12, 11, 9, 30, 0),
  endDate: DateTime(2023, 12, 11, 15, 0, 0),
);

final intradayData = await marketService.getIndexIntradayData(params);
```

### 3. å›¾è¡¨æ•°æ®ç‚¹ç”Ÿæˆ
```dart
// å†å²å›¾è¡¨ç‚¹
final chartPoints = await marketService.getHistoryChartPoints(
  '000001',
  startDate: DateTime.now().subtract(Duration(days: 60)),
  endDate: DateTime.now(),
);

// åˆ†æ—¶å›¾è¡¨ç‚¹
final intradayPoints = await marketService.getIntradayChartPoints(
  '000001',
  period: '5',
);
```

## å®æ—¶ vs å†å²æ•°æ®åŒºåˆ†

### å®æ—¶æ•°æ®è·å–
- **APIç«¯ç‚¹**: `/api/public/stock_zh_index_spot_em`
- **ç‰¹ç‚¹**: æ— éœ€æ—¶é—´å‚æ•°ï¼Œè·å–å½“å‰æœ€æ–°æ•°æ®
- **æ›´æ–°é¢‘ç‡**: ç¼“å­˜15åˆ†é’Ÿ
- **ä½¿ç”¨åœºæ™¯**: å®æ—¶è¡Œæƒ…å±•ç¤ºã€ä»·æ ¼æé†’

### å†å²æ•°æ®è·å–
- **APIç«¯ç‚¹**: `/api/public/stock_zh_index_daily_em`
- **ç‰¹ç‚¹**: æŒ‡å®šæ—¥æœŸèŒƒå›´ï¼Œè·å–å†å²OHLCVæ•°æ®
- **æ›´æ–°é¢‘ç‡**: ç¼“å­˜1å°æ—¶
- **ä½¿ç”¨åœºæ™¯**: å†å²è¶‹åŠ¿åˆ†æã€æŠ€æœ¯æŒ‡æ ‡è®¡ç®—

### åˆ†æ—¶æ•°æ®è·å–
- **APIç«¯ç‚¹**: `/api/public/index_zh_a_hist_min_em`
- **ç‰¹ç‚¹**: éœ€è¦periodå‚æ•°ï¼Œç²¾ç¡®åˆ°åˆ†é’Ÿçº§åˆ«
- **æ›´æ–°é¢‘ç‡**: ç¼“å­˜5åˆ†é’Ÿ
- **ä½¿ç”¨åœºæ™¯**: çŸ­æœŸèµ°åŠ¿åˆ†æã€ç›˜ä¸­äº¤æ˜“å†³ç­–

## æ”¯æŒçš„æ—¶é—´å‘¨æœŸ

åˆ†æ—¶æ•°æ®æ”¯æŒä»¥ä¸‹æ—¶é—´å‘¨æœŸï¼š
- **1åˆ†é’Ÿ**: `period = '1'` - æœ€ç²¾ç»†çš„åˆ†æ—¶æ•°æ®
- **5åˆ†é’Ÿ**: `period = '5'` - å¸¸ç”¨åˆ†æ—¶å‘¨æœŸ
- **15åˆ†é’Ÿ**: `period = '15'` - ä¸­æœŸåˆ†æ—¶æ•°æ®
- **30åˆ†é’Ÿ**: `period = '30'` - é•¿æœŸåˆ†æ—¶æ•°æ®
- **60åˆ†é’Ÿ**: `period = '60'` - å°æ—¶çº§åˆ«æ•°æ®

## é”™è¯¯å¤„ç†å’Œå®¹é”™æœºåˆ¶

1. **ç½‘ç»œé”™è¯¯å¤„ç†**
   - è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
   - æŒ‡æ•°é€€é¿å»¶è¿Ÿç­–ç•¥
   - ä¼˜é›…é™çº§è¿”å›ç©ºæ•°æ®

2. **ç¼“å­˜å®¹é”™**
   - ç¼“å­˜è¿‡æœŸè‡ªåŠ¨åˆ·æ–°
   - æœåŠ¡å™¨é”™è¯¯æ—¶ä½¿ç”¨ç¼“å­˜æ•°æ®
   - ç¼“å­˜é”®å†²çªé¿å…

3. **å‚æ•°éªŒè¯**
   - å¿…éœ€å‚æ•°æ£€æŸ¥
   - æ—¶é—´èŒƒå›´éªŒè¯
   - æŒ‡æ•°ä»£ç æ ¼å¼éªŒè¯

## ä½¿ç”¨ç¤ºä¾‹

å®Œæ•´çš„ä»£ç ç¤ºä¾‹è¯·å‚è€ƒ:
`lib/src/core/services/market_data_service_example.dart`

è¯¥ç¤ºä¾‹åŒ…å«ï¼š
- å†å²æ•°æ®è·å–
- åˆ†æ—¶æ•°æ®è·å–
- å¤šæ—¶é—´å‘¨æœŸå¯¹æ¯”
- å›¾è¡¨æ•°æ®ç”Ÿæˆ
- å®æ—¶ä¸å†å²æ•°æ®ç»“åˆä½¿ç”¨

## æ”¯æŒçš„æŒ‡æ•°ä»£ç 

```dart
const Map<String, String> SUPPORTED_INDICES = {
  '000001': 'ä¸Šè¯æŒ‡æ•°',
  '399001': 'æ·±è¯æˆæŒ‡',
  '399006': 'åˆ›ä¸šæ¿æŒ‡',
  '000300': 'æ²ªæ·±300',
  '000688': 'ç§‘åˆ›50',
  '399005': 'ä¸­å°æ¿æŒ‡',
  '399295': 'æ·±è¯100',
  '000905': 'ä¸­è¯500',
  '000016': 'ä¸Šè¯50',
  '000906': 'ä¸­è¯800',
};
```

## æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®ç¼“å­˜**: æ ¹æ®æ•°æ®ç‰¹æ€§é‡‡ç”¨ä¸åŒç¼“å­˜ç­–ç•¥
2. **å¹¶å‘æ§åˆ¶**: é™åˆ¶åŒæ—¶è¿›è¡Œçš„APIè¯·æ±‚æ•°é‡
3. **å†…å­˜ç®¡ç†**: åŠæ—¶æ¸…ç†è¿‡æœŸç¼“å­˜æ•°æ®
4. **è¯·æ±‚ä¼˜åŒ–**: åˆå¹¶ç›¸åŒå‚æ•°çš„è¯·æ±‚

## å¯¹æ¯”åˆ†ææ›´æ–°

### ğŸ“‹ å®Œæ•´å¯¹æ¯”è¡¨

| åŠŸèƒ½ | æ–‡æ¡£æè¿° | é¡¹ç›®å®ç° | APIç«¯ç‚¹ | å‚æ•°æ”¯æŒ | çŠ¶æ€ |
|------|----------|----------|---------|----------|------|
| å®æ—¶æŒ‡æ•° | stock_zh_index_spot_em | âœ… å·²å®ç° | `/api/public/stock_zh_index_spot_em` | æ— éœ€å‚æ•° | âœ… **æ­£ç¡®** |
| å†å²æŒ‡æ•°(æ—¥)-ä¸œæ–¹è´¢å¯Œ | stock_zh_index_daily_em | âœ… å·²å®ç° | `/api/public/stock_zh_index_daily_em` | symbol, start_date, end_date | âœ… **æ­£ç¡®** |
| å†å²æŒ‡æ•°(æ—¥)-æ–°æµª | stock_zh_index_daily | âœ… å·²å®ç° | `/api/public/stock_zh_index_daily` | symbol | âœ… **æ­£ç¡®** |
| å†å²æŒ‡æ•°(æ—¥)-è…¾è®¯ | stock_zh_index_daily_tx | âœ… å·²å®ç° | `/api/public/stock_zh_index_daily_tx` | symbol | âœ… **æ­£ç¡®** |
| åˆ†æ—¶å†å² | index_zh_a_hist_min_em | âœ… å·²å®ç° | `/api/public/index_zh_a_hist_min_em` | symbol, period, start_date, end_date | âœ… **æ­£ç¡®** |
| æ—¶é—´å‚æ•° | start_date, end_date | âœ… å·²å®ç° | - | å®Œæ•´æ”¯æŒæ—¥æœŸèŒƒå›´è¿‡æ»¤ | âœ… **æ­£ç¡®** |
| å‘¨æœŸå‚æ•° | period (1,5,15,30,60) | âœ… å·²å®ç° | - | æ”¯æŒ5ç§æ—¶é—´å‘¨æœŸ | âœ… **æ­£ç¡®** |

### ğŸ”§ APIç«¯ç‚¹éªŒè¯ç»“æœ

#### âœ… å®æ—¶æ•°æ®API
- **ç«¯ç‚¹**: `/api/public/stock_zh_index_spot_em`
- **å‚æ•°**: æ— 
- **æ•°æ®æº**: ä¸œæ–¹è´¢å¯Œ
- **çŠ¶æ€**: æ­£ç¡®å®ç°

#### âœ… å†å²æ•°æ®API - ä¸œæ–¹è´¢å¯Œ
- **ç«¯ç‚¹**: `/api/public/stock_zh_index_daily_em`
- **å‚æ•°**:
  - `symbol`: æŒ‡æ•°ä»£ç  (å¦‚: sz399552)
  - `start_date`: å¼€å§‹æ—¥æœŸ (YYYYMMDDæ ¼å¼)
  - `end_date`: ç»“æŸæ—¥æœŸ (YYYYMMDDæ ¼å¼)
- **æ•°æ®æº**: ä¸œæ–¹è´¢å¯Œ
- **çŠ¶æ€**: æ­£ç¡®å®ç°ï¼ŒåŒ…å«å®Œæ•´å‚æ•°æ”¯æŒ

#### âœ… å†å²æ•°æ®API - æ–°æµª
- **ç«¯ç‚¹**: `/api/public/stock_zh_index_daily`
- **å‚æ•°**:
  - `symbol`: æŒ‡æ•°ä»£ç  (å¦‚: sz399552)
- **æ•°æ®æº**: æ–°æµªè´¢ç»
- **çŠ¶æ€**: æ­£ç¡®å®ç°

#### âœ… å†å²æ•°æ®API - è…¾è®¯
- **ç«¯ç‚¹**: `/api/public/stock_zh_index_daily_tx`
- **å‚æ•°**:
  - `symbol`: æŒ‡æ•°ä»£ç  (å¦‚: sh000919)
- **æ•°æ®æº**: è…¾è®¯è´¢ç»
- **çŠ¶æ€**: æ­£ç¡®å®ç°

#### âœ… åˆ†æ—¶æ•°æ®API - ä¸œæ–¹è´¢å¯Œ
- **ç«¯ç‚¹**: `/api/public/index_zh_a_hist_min_em`
- **å‚æ•°**:
  - `symbol`: æŒ‡æ•°ä»£ç  (å¦‚: 000001)
  - `period`: æ—¶é—´å‘¨æœŸ ('1', '5', '15', '30', '60')
  - `start_date`: å¼€å§‹æ—¶é—´ (YYYY-MM-DD HH:MM:SSæ ¼å¼)
  - `end_date`: ç»“æŸæ—¶é—´ (YYYY-MM-DD HH:MM:SSæ ¼å¼)
- **æ•°æ®æº**: ä¸œæ–¹è´¢å¯Œ
- **çŠ¶æ€**: æ­£ç¡®å®ç°ï¼ŒåŒ…å«å®Œæ•´å‚æ•°æ”¯æŒ

### ğŸš€ æ–°å¢åŠŸèƒ½ç‰¹æ€§

#### 1. **å¤šæ•°æ®æºæ”¯æŒ**
```dart
// æ”¯æŒä¸‰ç§æ•°æ®æº
await marketService.getHistoryChartPoints('000001', source: 'eastmoney'); // é»˜è®¤
await marketService.getHistoryChartPoints('000001', source: 'sina');
await marketService.getHistoryChartPoints('000001', source: 'tencent');
```

#### 2. **å®Œæ•´çš„æ—¶é—´å‚æ•°æ”¯æŒ**
```dart
// ä¸œæ–¹è´¢å¯Œ - æ”¯æŒæ—¥æœŸèŒƒå›´å‚æ•°
final params = HistoryQueryParams(
  symbol: '000001',
  startDate: DateTime(2023, 1, 1),
  endDate: DateTime(2023, 12, 31),
);
await marketService.getIndexHistory(params);

// åˆ†æ—¶æ•°æ® - æ”¯æŒç²¾ç¡®æ—¶é—´èŒƒå›´
final intradayParams = HistoryQueryParams(
  symbol: '000001',
  period: '1',
  startDate: DateTime(2023, 12, 11, 9, 30, 0),
  endDate: DateTime(2023, 12, 11, 15, 0, 0),
);
```

#### 3. **å¤šå‘¨æœŸåˆ†æ—¶æ•°æ®**
```dart
// æ”¯æŒ5ç§æ—¶é—´å‘¨æœŸ
for (final period in ['1', '5', '15', '30', '60']) {
  final data = await marketService.getIntradayChartPoints('000001', period: period);
}
```

### ğŸ“Š æ•°æ®æ¨¡å‹é€‚é…

#### IndexHistoryData å·¥å‚æ–¹æ³•
```dart
// æ ¹æ®ä¸åŒæ•°æ®æºåˆ›å»º
IndexHistoryData.fromEastMoney(data, symbol, name);   // ä¸œæ–¹è´¢å¯Œ
IndexHistoryData.fromSina(data, symbol, name);         // æ–°æµª
IndexHistoryData.fromTencent(data, symbol, name);       // è…¾è®¯
```

#### å­—æ®µé€‚é…
- **ä¸œæ–¹è´¢å¯Œ**: å®Œæ•´OHLCV + amount
- **æ–°æµª**: OHLCV (æ— amount)
- **è…¾è®¯**: OHLC + amount (amountå•ä½ä¸ºæ‰‹ï¼Œæ— volume)

## æ€»ç»“

### âœ… å®Œå…¨å®ç°çš„åŠŸèƒ½

é€šè¿‡è¿™æ¬¡è¡¥å……ï¼Œé¡¹ç›®ç°åœ¨**å®Œå…¨æŒ‰ç…§æ–‡æ¡£è§„èŒƒ**å®ç°äº†æ‰€æœ‰åŠŸèƒ½ï¼š

- âœ… **å®æ—¶æ•°æ®**: ä¸œæ–¹è´¢å¯Œå®æ—¶æŒ‡æ•°æ•°æ®
- âœ… **å†å²æ•°æ®**: ä¸‰ä¸ªæ•°æ®æºï¼ˆä¸œè´¢ã€æ–°æµªã€è…¾è®¯ï¼‰çš„å®Œæ•´æ”¯æŒ
- âœ… **åˆ†æ—¶æ•°æ®**: ä¸œæ–¹è´¢å¯Œåˆ†æ—¶æ•°æ®ï¼Œæ”¯æŒ5ç§æ—¶é—´å‘¨æœŸ
- âœ… **æ—¶é—´å‚æ•°**: å®Œæ•´çš„start_date/end_dateæ”¯æŒ
- âœ… **å‘¨æœŸå‚æ•°**: æ”¯æŒ1,5,15,30,60åˆ†é’Ÿå‘¨æœŸ
- âœ… **æ™ºèƒ½ç¼“å­˜**: é’ˆå¯¹ä¸åŒæ•°æ®æºçš„å·®å¼‚åŒ–ç¼“å­˜ç­–ç•¥
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„ç½‘ç»œé”™è¯¯å’Œå‚æ•°éªŒè¯
- âœ… **å¤šæ•°æ®æº**: æ”¯æŒé€‰æ‹©ä¸åŒæ•°æ®æºè·å–æ•°æ®

### ğŸ¯ å…³é”®æˆå°±

1. **100%æ–‡æ¡£ç¬¦åˆæ€§**: æ‰€æœ‰APIç«¯ç‚¹å’Œå‚æ•°å®Œå…¨æŒ‰ç…§æ–‡æ¡£è§„èŒƒå®ç°
2. **å¤šæ•°æ®æºå†—ä½™**: æä¾›ä¸œè´¢ã€æ–°æµªã€è…¾è®¯ä¸‰ä¸ªæ•°æ®æº
3. **å®Œæ•´å‚æ•°æ”¯æŒ**: æ—¶é—´å‚æ•°å’Œå‘¨æœŸå‚æ•°å…¨éƒ¨å®ç°
4. **å‘åå…¼å®¹**: ä¿æŒåŸæœ‰æ¥å£ä¸å˜
5. **æ€§èƒ½ä¼˜åŒ–**: æ™ºèƒ½ç¼“å­˜å’Œè¯·æ±‚ä¼˜åŒ–

è¿™å¥—å®ç°ç°åœ¨**å®Œå…¨æ»¡è¶³äº†APIæ–‡æ¡£çš„æ‰€æœ‰è¦æ±‚**ï¼Œæä¾›äº†ä¼ä¸šçº§çš„æŒ‡æ•°æ•°æ®è·å–èƒ½åŠ›ï¼