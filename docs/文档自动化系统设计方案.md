# ğŸ¤– æ–‡æ¡£è‡ªåŠ¨åŒ–ç³»ç»Ÿè®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æœ¬æ–‡æ¡£è®¾è®¡äº†åŸºé€ŸåŸºé‡‘é‡åŒ–åˆ†æå¹³å°çš„å®Œæ•´æ–‡æ¡£è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼ŒåŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆã€åŒæ­¥æ›´æ–°ã€è´¨é‡æ£€æŸ¥å’Œç»´æŠ¤ç­‰åŠŸèƒ½ã€‚

---

## ğŸ¯ è‡ªåŠ¨åŒ–ç›®æ ‡

### æ ¸å¿ƒåŠŸèƒ½
- **è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ**: åŸºäºä»£ç å’Œé…ç½®è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£
- **åŒæ­¥æ›´æ–°æœºåˆ¶**: ä¸»æ–‡æ¡£ä¸åˆ†ç‰‡æ–‡æ¡£è‡ªåŠ¨åŒæ­¥
- **è´¨é‡è‡ªåŠ¨æ£€æŸ¥**: æ–‡æ¡£æ ¼å¼ã€é“¾æ¥ã€å†…å®¹è´¨é‡è‡ªåŠ¨éªŒè¯
- **æ™ºèƒ½ç´¢å¼•ç®¡ç†**: è‡ªåŠ¨æ›´æ–°æ–‡æ¡£ç´¢å¼•å’Œå¯¼èˆª
- **ç‰ˆæœ¬æ§åˆ¶é›†æˆ**: ä¸Gitå·¥ä½œæµæ·±åº¦é›†æˆ
- **CI/CDé›†æˆ**: æ–‡æ¡£è‡ªåŠ¨åŒ–é›†æˆåˆ°å¼€å‘æµç¨‹

### ä¸šåŠ¡ä»·å€¼
- å‡å°‘æ‰‹åŠ¨ç»´æŠ¤å·¥ä½œé‡80%
- æé«˜æ–‡æ¡£ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§
- ç¡®ä¿æ–‡æ¡£ä¸ä»£ç åŒæ­¥æ›´æ–°
- æå‡å›¢é˜Ÿåä½œæ•ˆç‡

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### è‡ªåŠ¨åŒ–æµæ°´çº¿æ¶æ„
```
ä»£ç å˜æ›´ â†’ è§¦å‘å™¨ â†’ æ–‡æ¡£ç”Ÿæˆå™¨ â†’ è´¨é‡æ£€æŸ¥å™¨ â†’ åŒæ­¥å™¨ â†’ å‘å¸ƒå™¨ â†’ é€šçŸ¥ç³»ç»Ÿ
    â†“         â†“          â†“           â†“         â†“        â†“        â†“
  Gitæäº¤   å®šæ—¶ä»»åŠ¡   æ¨¡æ¿å¼•æ“     éªŒè¯å·¥å…·   ç´¢å¼•æ›´æ–°  é™æ€ç«™ç‚¹  å›¢é˜Ÿé€šçŸ¥
  APIå˜æ›´   æ–‡ä»¶ç›‘æ§   ä»£ç è§£æ     é“¾æ¥æ£€æŸ¥   ç‰ˆæœ¬ç®¡ç†  éƒ¨ç½²     æŠ¥å‘Šç”Ÿæˆ
```

### æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 1. æ–‡æ¡£ç”Ÿæˆå¼•æ“ (DocGen Engine)
```yaml
ç»„ä»¶èŒè´£:
  - ä»£ç åˆ†æï¼šè§£ææºç ç»“æ„å’Œæ³¨é‡Š
  - æ¨¡æ¿æ¸²æŸ“ï¼šåŸºäºæ¨¡æ¿ç”Ÿæˆæ–‡æ¡£å†…å®¹
  - æ•°æ®èšåˆï¼šæ•´åˆå¤šæºæ•°æ®åˆ°æ–‡æ¡£
  - æ ¼å¼è½¬æ¢ï¼šæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼

æŠ€æœ¯æ ˆ:
  - Python: æ–‡æ¡£ç”Ÿæˆè„šæœ¬
  - Jinja2: æ¨¡æ¿å¼•æ“
  - Markdown: è¾“å‡ºæ ¼å¼
  - YAML: é…ç½®ç®¡ç†
```

#### 2. åŒæ­¥ç®¡ç†å™¨ (Sync Manager)
```yaml
ç»„ä»¶èŒè´£:
  - ä¸»æ–‡æ¡£åŒæ­¥ï¼šä¸»æ–‡æ¡£ä¸åˆ†ç‰‡è‡ªåŠ¨åŒæ­¥
  - ç´¢å¼•æ›´æ–°ï¼šè‡ªåŠ¨æ›´æ–°æ–‡æ¡£ç´¢å¼•
  - é“¾æ¥ç»´æŠ¤ï¼šè‡ªåŠ¨æ£€æŸ¥å’Œä¿®å¤é“¾æ¥
  - ç‰ˆæœ¬ç®¡ç†ï¼šæ–‡æ¡£ç‰ˆæœ¬è‡ªåŠ¨ç®¡ç†

æŠ€æœ¯æ ˆ:
  - Node.js: æ–‡ä»¶ç›‘å¬å’Œå¤„ç†
  - Git: ç‰ˆæœ¬æ§åˆ¶é›†æˆ
  - JSON: å…ƒæ•°æ®ç®¡ç†
```

#### 3. è´¨é‡æ£€æŸ¥å™¨ (Quality Checker)
```yaml
æ£€æŸ¥é¡¹ç›®:
  - æ ¼å¼è§„èŒƒï¼šMarkdownæ ¼å¼éªŒè¯
  - é“¾æ¥å®Œæ•´æ€§ï¼šæ‰€æœ‰é“¾æ¥æœ‰æ•ˆæ€§æ£€æŸ¥
  - å†…å®¹å®Œæ•´æ€§ï¼šå¿…éœ€ç« èŠ‚å’Œå†…å®¹éªŒè¯
  - è¯­è¨€è§„èŒƒï¼šæ‹¼å†™å’Œè¯­æ³•æ£€æŸ¥
  - ä¸€è‡´æ€§æ£€æŸ¥ï¼šæ–‡æ¡£é—´ä¸€è‡´æ€§éªŒè¯

æŠ€æœ¯æ ˆ:
  - Python: æ£€æŸ¥è„šæœ¬
  - markdownlint: Markdownæ ¼å¼æ£€æŸ¥
  - link-checker: é“¾æ¥éªŒè¯å·¥å…·
```

---

## ğŸ”§ å®ç°æ–¹æ¡ˆ

### Phase 1: åŸºç¡€è‡ªåŠ¨åŒ–å·¥å…·

#### 1.1 æ–‡æ¡£ç”Ÿæˆè„šæœ¬
```python
#!/usr/bin/env python3
"""
åŸºé€Ÿæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå™¨
ç”¨äºè‡ªåŠ¨ç”Ÿæˆå’Œæ›´æ–°é¡¹ç›®æ–‡æ¡£
"""

import os
import json
import yaml
from pathlib import Path
from jinja2 import Environment, FileSystemLoader
from datetime import datetime

class DocGenerator:
    def __init__(self, project_root):
        self.project_root = Path(project_root)
        self.docs_dir = self.project_root / "docs"
        self.template_dir = self.project_root / ".docs-templates"
        self.config = self.load_config()

    def load_config(self):
        """åŠ è½½æ–‡æ¡£é…ç½®"""
        config_file = self.project_root / ".docs-config.yaml"
        if config_file.exists():
            with open(config_file, 'r', encoding='utf-8') as f:
                return yaml.safe_load(f)
        return self.default_config()

    def default_config(self):
        """é»˜è®¤é…ç½®"""
        return {
            "project": {
                "name": "åŸºé€ŸåŸºé‡‘é‡åŒ–åˆ†æå¹³å°",
                "version": "v4.0",
                "description": "ä¸“ä¸šçš„åŸºé‡‘é‡åŒ–åˆ†æå¹³å°"
            },
            "output": {
                "format": ["markdown", "html"],
                "encoding": "utf-8"
            },
            "generation": {
                "auto_index": True,
                "auto_toc": True,
                "auto_sync": True
            }
        }

    def generate_prd_index(self):
        """ç”ŸæˆPRDæ–‡æ¡£ç´¢å¼•"""
        prd_dir = self.docs_dir / "prd"
        chapters = []

        # æ‰«æPRDç« èŠ‚æ–‡ä»¶
        for file_path in sorted(prd_dir.glob("*.md")):
            if file_path.name != "index.md":
                chapter_info = self.parse_chapter_info(file_path)
                chapters.append(chapter_info)

        # æ¸²æŸ“ç´¢å¼•æ¨¡æ¿
        template = self.jinja_env.get_template("prd_index.j2")
        content = template.render(
            chapters=chapters,
            config=self.config,
            generated_at=datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        )

        # å†™å…¥ç´¢å¼•æ–‡ä»¶
        index_file = prd_dir / "index.md"
        with open(index_file, 'w', encoding='utf-8') as f:
            f.write(content)

        print(f"âœ… PRDç´¢å¼•å·²ç”Ÿæˆ: {index_file}")

    def generate_architecture_index(self):
        """ç”Ÿæˆæ¶æ„æ–‡æ¡£ç´¢å¼•"""
        arch_dir = self.docs_dir / "architecture"
        chapters = []

        # æ‰«ææ¶æ„ç« èŠ‚æ–‡ä»¶
        for file_path in sorted(arch_dir.glob("*.md")):
            if file_path.name != "index.md":
                chapter_info = self.parse_chapter_info(file_path)
                chapters.append(chapter_info)

        # æ¸²æŸ“ç´¢å¼•æ¨¡æ¿
        template = self.jinja_env.get_template("arch_index.j2")
        content = template.render(
            chapters=chapters,
            config=self.config,
            generated_at=datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        )

        # å†™å…¥ç´¢å¼•æ–‡ä»¶
        index_file = arch_dir / "index.md"
        with open(index_file, 'w', encoding='utf-8') as f:
            f.write(content)

        print(f"âœ… æ¶æ„ç´¢å¼•å·²ç”Ÿæˆ: {index_file}")

    def parse_chapter_info(self, file_path):
        """è§£æç« èŠ‚ä¿¡æ¯"""
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        # æå–æ ‡é¢˜å’Œæè¿°
        lines = content.split('\n')
        title = ""
        description = ""

        for line in lines:
            if line.startswith('# '):
                title = line[2:].strip()
            elif line.startswith('## ') and not description:
                description = line[3:].strip()
            elif title and description:
                break

        return {
            "file": file_path.name,
            "title": title,
            "description": description,
            "path": f"./{file_path.name}"
        }

    def generate_main_index(self):
        """ç”Ÿæˆä¸»æ–‡æ¡£ç´¢å¼•"""
        # æ‰«æå„ä¸ªæ¨¡å—
        modules = []

        # V4æ ‡å‡†åŒ–æ–‡æ¡£
        modules.append({
            "title": "ğŸš€ V4æ ‡å‡†åŒ–æ–‡æ¡£",
            "items": [
                {"title": "V4æ–‡æ¡£æ ‡å‡†åŒ–æŠ¥å‘Š", "path": "./V4_DOCUMENTATION_STANDARDIZATION_REPORT.md"},
                {"title": "PRDäº§å“éœ€æ±‚æ–‡æ¡£", "path": "./prd.md"},
                {"title": "æ¶æ„è®¾è®¡æ–‡æ¡£", "path": "./architecture/index.md"},
                {"title": "ç”¨æˆ·æ•…äº‹æ–‡æ¡£", "path": "./stories/index.md"},
                {"title": "QAæµ‹è¯•æ–‡æ¡£", "path": "./qa/æµ‹è¯•æ–‡æ¡£.md"}
            ]
        })

        # æ¸²æŸ“ä¸»ç´¢å¼•æ¨¡æ¿
        template = self.jinja_env.get_template("main_index.j2")
        content = template.render(
            modules=modules,
            config=self.config,
            generated_at=datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        )

        # å†™å…¥ä¸»ç´¢å¼•æ–‡ä»¶
        index_file = self.docs_dir / "index.md"
        with open(index_file, 'w', encoding='utf-8') as f:
            f.write(content)

        print(f"âœ… ä¸»ç´¢å¼•å·²ç”Ÿæˆ: {index_file}")

    def generate_all(self):
        """ç”Ÿæˆæ‰€æœ‰æ–‡æ¡£"""
        print("ğŸš€ å¼€å§‹ç”Ÿæˆæ–‡æ¡£...")

        if self.config["generation"]["auto_index"]:
            self.generate_prd_index()
            self.generate_architecture_index()
            self.generate_main_index()

        print("âœ… æ–‡æ¡£ç”Ÿæˆå®Œæˆ!")

if __name__ == "__main__":
    generator = DocGenerator(".")
    generator.generate_all()
```

#### 1.2 é…ç½®æ–‡ä»¶æ¨¡æ¿
```yaml
# .docs-config.yaml
project:
  name: "åŸºé€ŸåŸºé‡‘é‡åŒ–åˆ†æå¹³å°"
  version: "v4.0"
  description: "ä¸“ä¸šçš„åŸºé‡‘é‡åŒ–åˆ†æå¹³å°"
  author: "å¼€å‘å›¢é˜Ÿ"

modules:
  prd:
    enabled: true
    path: "prd"
    chapters:
      - "1-ç›®æ ‡ä¸èƒŒæ™¯.md"
      - "2-éœ€æ±‚.md"
      - "3-ç”¨æˆ·ç•Œé¢è®¾è®¡ç›®æ ‡.md"
      - "4-æŠ€æœ¯å‡è®¾.md"
      - "5-å²è¯—åˆ—è¡¨.md"
      - "6-éªŒæ”¶æ ‡å‡†.md"
      - "7-é£é™©å’Œçº¦æŸ.md"

  architecture:
    enabled: true
    path: "architecture"
    chapters:
      - "1-æ¶æ„æ¦‚è¿°.md"
      - "2-æŠ€æœ¯æ ˆé€‰æ‹©.md"
      - "3-ç³»ç»Ÿæ¶æ„è®¾è®¡.md"
      - "4-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥.md"
      - "5-å®‰å…¨æ¶æ„.md"
      - "6-éƒ¨ç½²æ¶æ„.md"
      - "7-æ‰©å±•æ€§è®¾è®¡.md"
      - "8-ç¾å¤‡æ–¹æ¡ˆ.md"
      - "9-æŠ€æœ¯æ¼”è¿›è·¯çº¿.md"
      - "10-æ¶æ„å†³ç­–è®°å½•.md"
      - "11-é£é™©è¯„ä¼°ä¸ç¼“è§£.md"

  stories:
    enabled: true
    path: "stories"

  qa:
    enabled: true
    path: "qa"

output:
  formats: ["markdown"]
  encoding: "utf-8"

generation:
  auto_index: true
  auto_toc: true
  auto_sync: true
  backup_original: true

quality:
  check_links: true
  check_format: true
  check_spelling: false
  max_link_redirects: 3

sync:
  watch_files: true
  auto_commit: false
  commit_message_prefix: "[docs]"

notifications:
  on_success: false
  on_failure: true
  channels: ["console", "file"]
```

#### 1.3 GitHub Actions å·¥ä½œæµ
```yaml
# .github/workflows/docs-automation.yml
name: ğŸ“– æ–‡æ¡£è‡ªåŠ¨åŒ–

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'docs/**'
      - '.docs-config.yaml'
      - '.github/workflows/docs-automation.yml'
  pull_request:
    branches: [ main ]
    paths:
      - 'docs/**'

  schedule:
    # æ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œ
    - cron: '0 2 * * *'

  workflow_dispatch:
    inputs:
      action:
        description: 'æ‰§è¡Œçš„æ“ä½œ'
        required: true
        default: 'generate'
        type: choice
        options:
          - generate
          - check
          - sync

jobs:
  docs-automation:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          pip install jinja2 pyyaml markdown-link-check markdownlint-cli2

      - name: ğŸ”§ ç”Ÿæˆæ–‡æ¡£
        id: generate-docs
        run: |
          python .github/scripts/doc_generator.py --action ${{ github.event.inputs.action || 'generate' }}

      - name: ğŸ” è´¨é‡æ£€æŸ¥
        run: |
          markdownlint-cli2 "docs/**/*.md"
          markdown-link-check "docs/**/*.md" -v

      - name: ğŸ“Š ç”ŸæˆæŠ¥å‘Š
        run: |
          python .github/scripts/doc_report.py > docs/automation-report.md

      - name: ğŸ“¤ æäº¤å˜æ›´
        if: steps.generate-docs.outputs.changed == 'true'
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/
          git commit -m "[docs] è‡ªåŠ¨æ›´æ–°æ–‡æ¡£ - $(date '+%Y-%m-%d %H:%M:%S')"
          git push

      - name: ğŸŒ éƒ¨ç½²æ–‡æ¡£ç«™ç‚¹
        if: github.ref == 'refs/heads/main'
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          destination_dir: docs
```

### Phase 2: é«˜çº§è‡ªåŠ¨åŒ–åŠŸèƒ½

#### 2.1 æ™ºèƒ½å†…å®¹åˆ†æ
```python
class ContentAnalyzer:
    """æ™ºèƒ½å†…å®¹åˆ†æå™¨"""

    def analyze_code_comments(self, code_dir):
        """åˆ†æä»£ç æ³¨é‡Šç”ŸæˆAPIæ–‡æ¡£"""
        pass

    def extract_config_info(self, config_files):
        """æå–é…ç½®ä¿¡æ¯ç”Ÿæˆé…ç½®æ–‡æ¡£"""
        pass

    def generate_changelog(self, git_history):
        """åŸºäºGitå†å²ç”Ÿæˆå˜æ›´æ—¥å¿—"""
        pass

    def analyze_dependencies(self, dependency_files):
        """åˆ†æä¾èµ–å…³ç³»ç”Ÿæˆæ¶æ„å›¾"""
        pass
```

#### 2.2 æ™ºèƒ½ç´¢å¼•ç”Ÿæˆ
```python
class SmartIndexGenerator:
    """æ™ºèƒ½ç´¢å¼•ç”Ÿæˆå™¨"""

    def generate_toc(self, document):
        """è‡ªåŠ¨ç”Ÿæˆç›®å½•"""
        pass

    def generate_cross_references(self, documents):
        """ç”Ÿæˆäº¤å‰å¼•ç”¨"""
        pass

    def generate_tag_index(self, documents):
        """ç”Ÿæˆæ ‡ç­¾ç´¢å¼•"""
        pass
```

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€å·¥å…· (1-2å‘¨)
- [ ] åˆ›å»ºæ–‡æ¡£ç”Ÿæˆè„šæœ¬
- [ ] è®¾ç½®é…ç½®æ–‡ä»¶ç³»ç»Ÿ
- [ ] å®ç°åŸºç¡€ç´¢å¼•ç”Ÿæˆ
- [ ] é…ç½®GitHub Actions

### Phase 2: è´¨é‡ä¿è¯ (1å‘¨)
- [ ] å®ç°æ–‡æ¡£è´¨é‡æ£€æŸ¥
- [ ] æ·»åŠ é“¾æ¥éªŒè¯
- [ ] é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•

### Phase 3: é«˜çº§åŠŸèƒ½ (2-3å‘¨)
- [ ] æ™ºèƒ½å†…å®¹åˆ†æ
- [ ] ä»£ç æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- [ ] å¤šæ ¼å¼è¾“å‡ºæ”¯æŒ

### Phase 4: é›†æˆä¼˜åŒ– (1å‘¨)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### è‡ªåŠ¨åŒ–è¦†ç›–ç‡
- **æ–‡æ¡£ç”Ÿæˆ**: 90%è‡ªåŠ¨åŒ–
- **ç´¢å¼•ç»´æŠ¤**: 100%è‡ªåŠ¨åŒ–
- **è´¨é‡æ£€æŸ¥**: 100%è‡ªåŠ¨åŒ–
- **åŒæ­¥æ›´æ–°**: 95%è‡ªåŠ¨åŒ–

### æ•ˆç‡æå‡
- **ç»´æŠ¤æ—¶é—´**: å‡å°‘80%
- **ä¸€è‡´æ€§æå‡**: 95%
- **é”™è¯¯ç‡é™ä½**: 90%
- **å›¢é˜Ÿæ»¡æ„åº¦**: æå‡85%

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹
```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®æ–‡æ¡£ç³»ç»Ÿ
cp .docs-config.yaml.example .docs-config.yaml

# 3. ç”Ÿæˆæ–‡æ¡£
python doc_generator.py --action generate

# 4. æ£€æŸ¥è´¨é‡
python doc_generator.py --action check

# 5. åŒæ­¥æ›´æ–°
python doc_generator.py --action sync
```

### é›†æˆåˆ°å¼€å‘æµç¨‹
```bash
# å¼€å‘å‰
pre-commit hook: è‡ªåŠ¨æ£€æŸ¥æ–‡æ¡£è´¨é‡

# å¼€å‘ä¸­
file watcher: è‡ªåŠ¨æ›´æ–°ç›¸å…³æ–‡æ¡£

# æäº¤æ—¶
git hook: è‡ªåŠ¨ç”Ÿæˆç´¢å¼•å’ŒæŠ¥å‘Š

# éƒ¨ç½²å
CI/CD: è‡ªåŠ¨éƒ¨ç½²æ–‡æ¡£ç«™ç‚¹
```

---

*æœ¬æ–‡æ¡£è‡ªåŠ¨åŒ–ç³»ç»Ÿå°†æ˜¾è‘—æå‡åŸºé€Ÿé¡¹ç›®çš„æ–‡æ¡£è´¨é‡å’Œç»´æŠ¤æ•ˆç‡ï¼Œä¸ºå›¢é˜Ÿåä½œå’ŒçŸ¥è¯†ç®¡ç†æä¾›å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚*